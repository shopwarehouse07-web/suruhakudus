<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suruh Akudus - Order Otomatis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 10px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 20px; }
        .header img { width: 80px; }
        
        .menu-icons { display: flex; justify-content: space-between; margin-bottom: 20px; gap: 5px; }
        .icon-item { text-align: center; flex: 1; cursor: pointer; padding: 5px; border-radius: 10px; border: 1px solid #eee; }
        .icon-item img { width: 100%; max-width: 50px; display: block; margin: auto; }
        .icon-item span { font-size: 10px; font-weight: bold; display: block; margin-top: 5px; }
        .active { background: #e7f3ff; border-color: #0056b3; }

        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
        select, input, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        .result-box { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 5px solid #0056b3; }
        .price { font-size: 20px; color: #d9534f; font-weight: bold; }
        
        button { width: 100%; padding: 15px; background-color: #25D366; color: white; border: none; border-radius: 8px; margin-top: 20px; font-size: 16px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background-color: #128C7E; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>SURUH AKUDUS</h2>
        <p>Layanan Cepat & Amanah Asli Kudus</p>
    </div>

    <div class="menu-icons">
        <div class="icon-item active" onclick="setLayanan('Ojek', 3500, this)">
            <img src="URL_ICON_MOTOR_ANDA" alt="Ojek">
            <span>Ojek</span>
        </div>
        <div class="icon-item" onclick="setLayanan('Kirim Barang', 3000, this)">
            <img src="URL_ICON_BOX_ANDA" alt="Kurir">
            <span>Kurir</span>
        </div>
        <div class="icon-item" onclick="setLayanan('Makanan/Mart', 4000, this)">
            <img src="URL_ICON_MAKAN_ANDA" alt="Titip">
            <span>Jastip</span>
        </div>
    </div>

    <label>Lokasi Jemput (Nama Tempat/Jalan):</label>
    <input type="text" id="jemput" placeholder="Contoh: Menara Kudus" onchange="hitungJarak()">

    <label>Lokasi Tujuan:</label>
    <input type="text" id="tujuan" placeholder="Contoh: Simpang Tujuh Kudus" onchange="hitungJarak()">

    <label>Catatan:</label>
    <textarea id="catatan" placeholder="Contoh: Beli Nasi Goreng Pak Kumis pedas satu"></textarea>

    <div class="result-box">
        <div>Estimasi Jarak: <span id="jarak-teks">0 km</span></div>
        <div>Total Tarif: <span class="price" id="tarif-teks">Rp0</span></div>
        <small>*Tarif minimum Rp8.000 berlaku</small>
    </div>

    <button onclick="kirimWA()">PESAN SEKARANG VIA WA</button>
</div>

<script>
    let hargaPerKm = 3500;
    let namaLayanan = "Ojek";
    let jarakFinal = 0;
    let tarifFinal = 0;

    function setLayanan(nama, harga, el) {
        namaLayanan = nama;
        hargaPerKm = harga;
        document.querySelectorAll('.icon-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        hitungJarak();
    }

    async function getCoords(address) {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${address}, Kudus`);
        const data = await response.json();
        if (data.length > 0) {
            return [data[0].lat, data[0].lon];
        }
        return null;
    }

    async function hitungJarak() {
        const loc1 = document.getElementById('jemput').value;
        const loc2 = document.getElementById('tujuan').value;

        if (loc1 && loc2) {
            const coord1 = await getCoords(loc1);
            const coord2 = await getCoords(loc2);

            if (coord1 && coord2) {
                // Rumus Haversine untuk jarak garis lurus
                const R = 6371;
                const dLat = (coord2[0] - coord1[0]) * Math.PI / 180;
                const dLon = (coord2[1] - coord1[1]) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                          Math.cos(coord1[0] * Math.PI / 180) * Math.cos(coord2[0] * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                const d = R * c;

                // Tambahkan 20% karena jalanan tidak lurus (estimasi rute)
                jarakFinal = (d * 1.2).toFixed(1);
                
                // Hitung Tarif
                tarifFinal = jarakFinal * hargaPerKm;
                if (tarifFinal < 8000) tarifFinal = 8000; // Tarif Minimum

                document.getElementById('jarak-teks').innerText = jarakFinal + " km";
                document.getElementById('tarif-teks').innerText = "Rp" + Math.round(tarifFinal).toLocaleString('id-ID');
            }
        }
    }

    function kirimWA() {
        const nomorWA = "6285124569347"; // GANTI NOMOR ANDA
        const jemput = document.getElementById('jemput').value;
        const tujuan = document.getElementById('tujuan').value;
        const catatan = document.getElementById('catatan').value;

        if (!jemput || !tujuan) { alert("Isi lokasi dulu lur!"); return; }

        const pesan = `*ORDER SURUH AKUDUS*%0A` +
                      `--------------------------%0A` +
                      `*Layanan:* ${namaLayanan}%0A` +
                      `*Jemput:* ${jemput}%0A` +
                      `*Tujuan:* ${tujuan}%0A` +
                      `*Jarak:* ~${jarakFinal} km%0A` +
                      `*Tarif:* Rp${Math.round(tarifFinal).toLocaleString('id-ID')}%0A` +
                      `*Catatan:* ${catatan}%0A` +
                      `--------------------------%0A` +
                      `_Cepat & Amanah Asli Kudus_`;

        window.open(`https://wa.me/${nomorWA}?text=${pesan}`, '_blank');
    }
</script>

</body>
</html>
